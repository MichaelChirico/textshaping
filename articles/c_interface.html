<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>textshaping C interface • textshaping</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="textshaping C interface">
<meta property="og:description" content="textshaping">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">textshaping</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/c_interface.html">textshaping C interface</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/r-lib/textshaping/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="c_interface_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>textshaping C interface</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-lib/textshaping/blob/master/vignettes/c_interface.Rmd"><code>vignettes/c_interface.Rmd</code></a></small>
      <div class="hidden name"><code>c_interface.Rmd</code></div>

    </div>

    
    
<p>textshaping is predominantly intended to be used by other packages implementing graphic devicees and calling it from the C level. As such it exports a set of functions that match the needs of graphic devices. The C API builds upon that of systemfonts and you’ll thus need to link to both packages to access it succesfully. This is done with the <code>LinkingTo</code> field in the <code>DESCRIPTION</code> file:</p>
<pre><code>LinkingTo: 
    systemfonts,
    textshaping</code></pre>
<p>You will further need to make sure that both packages are loaded when you need to use the C API. This is most easily done by importing a function from each package into your namespace.</p>
<p>In your C/C++ code you’ll then have <code>#include &lt;textshaping.h&gt;</code> to get access to the functions described below.</p>
<p>The C API expects fonts to be given as <code>FontSettings</code> structs which can be obtained from the systemfonts C API with <code>locate_font_with_features()</code>. This makes it possible to both get access to the font file location along with potential OpenType features registered to the font.</p>
<div id="string-width" class="section level2">
<h2 class="hasAnchor">
<a href="#string-width" class="anchor"></a>String width</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb2-1"><a href="#cb2-1"></a><span class="dt">int</span> ts_string_width(</span>
<span id="cb2-2"><a href="#cb2-2"></a>  <span class="dt">const</span> <span class="dt">char</span>* string, </span>
<span id="cb2-3"><a href="#cb2-3"></a>  FontSettings font_info, </span>
<span id="cb2-4"><a href="#cb2-4"></a>  <span class="dt">double</span> size, </span>
<span id="cb2-5"><a href="#cb2-5"></a>  <span class="dt">double</span> res, </span>
<span id="cb2-6"><a href="#cb2-6"></a>  <span class="dt">int</span> include_bearing, </span>
<span id="cb2-7"><a href="#cb2-7"></a>  <span class="dt">double</span>* width</span>
<span id="cb2-8"><a href="#cb2-8"></a>)</span></code></pre></div>
<p>This function calculates the width of a string, ignoring any newlines (these are automatically being handled by the graphic engine). It takes a UTF-8 encoded string, along with a FontSettings struct to use for shaping the string before calculating the width. It also take a size in pt and a res in ppi for setting the size. In addition it takes an include_bearing flag to control whether the bearings of the first and last character should be taken into account (this is recommended by the graphic engine). It will write the width in pts to the passed in pointer and return 0 if successful.</p>
</div>
<div id="string-shape" class="section level2">
<h2 class="hasAnchor">
<a href="#string-shape" class="anchor"></a>String shape</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb3-1"><a href="#cb3-1"></a><span class="dt">int</span> ts_string_shape(</span>
<span id="cb3-2"><a href="#cb3-2"></a>  <span class="dt">const</span> <span class="dt">char</span>* string, </span>
<span id="cb3-3"><a href="#cb3-3"></a>  FontSettings font_info,</span>
<span id="cb3-4"><a href="#cb3-4"></a>  <span class="dt">double</span> size, </span>
<span id="cb3-5"><a href="#cb3-5"></a>  <span class="dt">double</span> res, </span>
<span id="cb3-6"><a href="#cb3-6"></a>  <span class="dt">double</span>* x, </span>
<span id="cb3-7"><a href="#cb3-7"></a>  <span class="dt">double</span>* y,</span>
<span id="cb3-8"><a href="#cb3-8"></a>  <span class="dt">int</span>* id, </span>
<span id="cb3-9"><a href="#cb3-9"></a>  <span class="dt">int</span>* cluster, </span>
<span id="cb3-10"><a href="#cb3-10"></a>  <span class="dt">int</span>* n_glyphs,</span>
<span id="cb3-11"><a href="#cb3-11"></a>  <span class="dt">unsigned</span> <span class="dt">int</span> max_length</span>
<span id="cb3-12"><a href="#cb3-12"></a>)</span></code></pre></div>
<p>This function takes care of all the nitty-gritty of shaping a single line of text. It takes the same font information input as <code>ts_string_width()</code>, that is, a <code>FontSettings</code> struct and size and res. It further accepts a number of array pointers where the shaping information will be written. <code>x</code> and <code>y</code> will end up containing the location of each glyph in pts starting from a (0, 0) origin. Since the graphic engine only pass single lines to the graphic device at a time then line breaking is not handled and for now all returned y positions are set to 0.0 (this may change in the future depending on the development of the graphic engine). The glyph id in the font file will be written to the <code>id</code> array. You will need to use this to look up the glyph to render instead of relying on the characters in the input string due to the potential substitution and merging of glyphs happening during shaping. The <code>cluster</code> array is currently unused (and will thus not be touched) but may in the future contain identifications of which character in the input string relates to the provided glyphs. <code>n_glyphs</code> will be set to the total number of written glyphs and positions as a result of the shaping. <code>max_length</code> should be set to the maximum available space in <code>x</code>, <code>y</code>, and <code>id</code>. No information will be written beyond that length. The function returns 0 if successful.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Thomas Lin Pedersen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
